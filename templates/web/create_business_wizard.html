{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center mt-4">
    <div class="col-md-8">
        <div class="hub-form-card">
            <h2 class="hub-form-title">üõ† –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±–∏–∑–Ω–µ—Å–∞</h2>
            <p class="hub-form-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏—à—É –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏ –¥–ª—è –≤–∞—à–µ–π CRM</p>

            <form method="post" id="wizard-form">
                {% csrf_token %}

                <!-- –®–∞–≥ 1: –ù–∞–∑–≤–∞–Ω–∏–µ -->
                <div class="mb-4">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏</label>
                    <input type="text" name="name" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Coffee Hub" required>
                </div>

                <!-- –®–∞–≥ 2: –ù–∏—à–∞ -->
                <div class="mb-4">
                    <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏—à—É</label>
                    <select name="niche" id="niche-select" class="form-select" required>
                        <option value="" disabled selected>-- –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∏—à—É --</option>
                        {% for code, name in niches %}
                            <option value="{{ code }}">{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- –®–∞–≥ 3: –ú–æ–¥—É–ª–∏ -->
                <div class="mb-4">
                    <label class="form-label d-block mb-3">–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏</label>
                    <div class="row g-3">
                        {% for module in all_modules %}
                        <div class="col-md-6">
                            <div class="hub-list-item p-3 d-flex align-items-center gap-3">
                                <input class="form-check-input module-checkbox" type="checkbox" 
                                       name="modules" value="{{ module.slug }}" id="mod_{{ module.slug }}">
                                <label class="form-check-label" for="mod_{{ module.slug }}">
                                    <div class="fw-bold">{{ module.name }}</div>
                                    <div class="hub-micro">{{ module.description }}</div>
                                </label>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-5">
                    <a href="{% url 'web:dashboard' %}" class="hub-btn hub-btn-ghost">–û—Ç–º–µ–Ω–∞</a>
                    <button type="submit" class="hub-btn hub-btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–π –±–∏–∑–Ω–µ—Å üöÄ</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// –õ–û–ì–ò–ö–ê –ö–û–ù–°–¢–†–£–ö–¢–û–†–ê
const nicheSelect = document.getElementById('niche-select');
const checkboxes = document.querySelectorAll('.module-checkbox');

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π –¥–ª—è –Ω–∏—à
const nicheConfig = {
    'CLOTHES': {
        required: ['catalog', 'inventory', 'sales'],
        recommended: ['online_orders']
    },
    'CAFE': {
        required: ['catalog', 'sales'],
        recommended: ['consumables', 'inventory']
    },
    'BEAUTY': {
        required: ['catalog'],
        recommended: ['consumables']
    }
};

nicheSelect.addEventListener('change', (e) => {
    const selectedNiche = e.target.value;
    const config = nicheConfig[selectedNiche];

    checkboxes.forEach(cb => {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å—ë
        cb.checked = false;
        cb.disabled = false;
        cb.parentElement.classList.remove('opacity-50');

        if (config) {
            // –ï—Å–ª–∏ –º–æ–¥—É–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π
            if (config.required.includes(cb.value)) {
                cb.checked = true;
                cb.disabled = false; // –û—Å—Ç–∞–≤–ª—è–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–º –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã, –Ω–æ –º–æ–∂–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ
                // –ß—Ç–æ–±—ã –∑–Ω–∞—á–µ–Ω–∏–µ —É–ª–µ—Ç–µ–ª–æ –≤ POST, disabled –ª—É—á—à–µ –Ω–µ —Å—Ç–∞–≤–∏—Ç—å, 
                // –ª–∏–±–æ –¥–æ–±–∞–≤–∏—Ç—å hidden input. –°–¥–µ–ª–∞–µ–º –ø—Ä–æ—Å—Ç–æ checked.
            }
            // –ï—Å–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π
            if (config.recommended.includes(cb.value)) {
                cb.checked = true;
            }
        }
    });
});
</script>
{% endblock %}